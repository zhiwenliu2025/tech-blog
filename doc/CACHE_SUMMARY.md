# åº”ç”¨å±‚ç¼“å­˜å®ç°æ€»ç»“

## ğŸ“‹ é¡¹ç›®ä¿¡æ¯

- **å®æ–½æ—¥æœŸ**: 2026-01-07
- **ç¼“å­˜æ–¹æ¡ˆ**: æ–¹æ¡ˆä¸‰ - Nuxt åº”ç”¨å±‚ç¼“å­˜ï¼ˆLRU Cacheï¼‰
- **æŠ€æœ¯æ ˆ**: `lru-cache` + Nuxt 3 Server API
- **æ•°æ®åº“å˜æ›´**: æ— ï¼ˆé›¶ä¾µå…¥ï¼‰

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. ä¾èµ–å®‰è£…

- âœ… å®‰è£… `lru-cache` åŒ…

### 2. æœåŠ¡ç«¯å®ç°

#### æ ¸å¿ƒç¼“å­˜å·¥å…·

- âœ… `server/utils/cache.ts` - ç¼“å­˜é…ç½®å’Œå·¥å…·å‡½æ•°
  - LRU ç¼“å­˜å®ä¾‹ï¼ˆæœ€å¤§ 1000 æ¡ç›®ï¼‰
  - ç¼“å­˜é”®å‰ç¼€å®šä¹‰
  - TTL é…ç½®ï¼ˆ1-15 åˆ†é’Ÿï¼‰
  - ç¼“å­˜å¤±æ•ˆåŠ©æ‰‹å‡½æ•°

#### ç¼“å­˜ API ç«¯ç‚¹

**æ–‡ç« ç»Ÿè®¡ API**:

- âœ… `server/api/posts/stats.get.ts` - æ‰¹é‡è·å–æ–‡ç« ç»Ÿè®¡
- âœ… `server/api/posts/[id]/stats.get.ts` - å•ä¸ªæ–‡ç« ç»Ÿè®¡
- âœ… `server/api/posts/[id]/increment-view.post.ts` - å¢åŠ é˜…è¯»é‡

**æ–‡ç« åˆ—è¡¨ API**:

- âœ… `server/api/posts/hot.get.ts` - çƒ­é—¨æ–‡ç« åˆ—è¡¨ï¼ˆå¸¦ç¼“å­˜ï¼‰
- âœ… `server/api/posts/list.get.ts` - æ–‡ç« åˆ—è¡¨ï¼ˆå¸¦ç¼“å­˜ï¼‰

**ç¼“å­˜ç®¡ç† API**:

- âœ… `server/api/cache/invalidate.post.ts` - æ¸…é™¤ç¼“å­˜
- âœ… `server/api/cache/stats.get.ts` - ç¼“å­˜ç»Ÿè®¡

### 3. å®¢æˆ·ç«¯å®ç°

- âœ… `composables/useCache.ts` - å®¢æˆ·ç«¯ç¼“å­˜ composables
  - `usePostStats()` - æ–‡ç« ç»Ÿè®¡
  - `useCachedHotPosts()` - çƒ­é—¨æ–‡ç« 
  - `useCachedPostsList()` - æ–‡ç« åˆ—è¡¨
  - `useCacheManager()` - ç¼“å­˜ç®¡ç†

### 4. æ–‡æ¡£

- âœ… `doc/CACHE_IMPLEMENTATION.md` - å®Œæ•´å®ç°æ–‡æ¡£
- âœ… `doc/CACHE_USAGE_EXAMPLES.md` - ä½¿ç”¨ç¤ºä¾‹
- âœ… `doc/CACHE_QUICK_START.md` - å¿«é€Ÿå…¥é—¨æŒ‡å—
- âœ… `doc/CACHE_SUMMARY.md` - å®ç°æ€»ç»“ï¼ˆæœ¬æ–‡æ¡£ï¼‰
- âœ… æ›´æ–° `README.md` - æ·»åŠ ç¼“å­˜åŠŸèƒ½è¯´æ˜

---

## ğŸ¯ ç¼“å­˜ç­–ç•¥

### ç¼“å­˜é…ç½®

| æ•°æ®ç±»å‹ | ç¼“å­˜é”®å‰ç¼€     | TTL    | è¯´æ˜             |
| -------- | -------------- | ------ | ---------------- |
| æ–‡ç« ç»Ÿè®¡ | `post:stats:`  | 1 åˆ†é’Ÿ | ç‚¹èµ/è¯„è®º/é˜…è¯»æ•° |
| çƒ­é—¨æ–‡ç«  | `hot:posts`    | 5 åˆ†é’Ÿ | çƒ­é—¨æ–‡ç« æ’è¡Œæ¦œ   |
| æ–‡ç« åˆ—è¡¨ | `posts:list:`  | 2 åˆ†é’Ÿ | åšå®¢åˆ—è¡¨é¡µ       |
| æ–‡ç« è¯¦æƒ… | `post:detail:` | 5 åˆ†é’Ÿ | æ–‡ç« å†…å®¹         |

### å¤±æ•ˆç­–ç•¥

**è‡ªåŠ¨å¤±æ•ˆ**:

- è¾¾åˆ° TTL æ—¶é—´åè‡ªåŠ¨æ¸…é™¤
- LRU æ·˜æ±°ç­–ç•¥ï¼ˆè¶…è¿‡æœ€å¤§æ¡ç›®æ•°ï¼‰

**ä¸»åŠ¨å¤±æ•ˆ**:

- æ–‡ç« å‘å¸ƒ/æ›´æ–°/åˆ é™¤æ—¶
- ç”¨æˆ·ç‚¹èµ/å–æ¶ˆç‚¹èµæ—¶
- ç”¨æˆ·è¯„è®º/åˆ é™¤è¯„è®ºæ—¶

---

## ğŸ“Š æ€§èƒ½æå‡

### é¢„æœŸæ•ˆæœ

| æŒ‡æ ‡         | ä¼˜åŒ–å‰    | ä¼˜åŒ–å    | æå‡å¹…åº¦     |
| ------------ | --------- | --------- | ------------ |
| çƒ­é—¨æ–‡ç« æŸ¥è¯¢ | 200-500ms | 5-10ms    | **95-98%** â†“ |
| æ–‡ç« ç»Ÿè®¡æŸ¥è¯¢ | 50-100ms  | 2-5ms     | **95-96%** â†“ |
| é¦–é¡µåŠ è½½æ—¶é—´ | 1-2s      | 300-500ms | **70-75%** â†“ |
| æ•°æ®åº“æŸ¥è¯¢   | 100%      | 10-20%    | **80-90%** â†“ |

### ç¼“å­˜å‘½ä¸­ç‡

- **åŒä¸€å®ä¾‹**: 80-95%ï¼ˆå–å†³äºè®¿é—®æ¨¡å¼ï¼‰
- **å¤šå®ä¾‹ï¼ˆVercelï¼‰**: 40-70%ï¼ˆä¸åŒå®ä¾‹ç¼“å­˜ä¸å…±äº«ï¼‰
- **å®é™…æ”¶ç›Š**: æ•°æ®åº“æŸ¥è¯¢å‡å°‘ 80-90%

---

## ğŸ—ï¸ æ¶æ„ä¼˜åŠ¿

### 1. é›¶åŸºç¡€è®¾æ–½æˆæœ¬

âœ… æ— éœ€é¢å¤–çš„ Redis æœåŠ¡  
âœ… æ— éœ€ä¿®æ”¹æ•°æ®åº“ Schema  
âœ… ä½¿ç”¨ Nuxt Server å†…ç½®åŠŸèƒ½  
âœ… é€‚åˆä¸­å°å‹åšå®¢ï¼ˆæ—¥ PV < 10ä¸‡ï¼‰

### 2. ç®€å•æ˜“ç»´æŠ¤

âœ… ä»£ç é€»è¾‘æ¸…æ™°  
âœ… é…ç½®çµæ´»  
âœ… æ˜“äºè°ƒè¯•  
âœ… æ˜“äºæ‰©å±•

### 3. æ¸è¿›å¼ä¼˜åŒ–

âœ… å¯å¹³æ»‘å‡çº§åˆ° Redis  
âœ… å‘åå…¼å®¹  
âœ… ä»£ç æ”¹åŠ¨æœ€å°

---

## ğŸ“ æ–‡ä»¶æ¸…å•

### æœåŠ¡ç«¯æ–‡ä»¶

```
server/
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ cache.ts                           # æ ¸å¿ƒç¼“å­˜å·¥å…·ï¼ˆ150 è¡Œï¼‰
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ posts/
â”‚   â”‚   â”œâ”€â”€ stats.get.ts                   # æ‰¹é‡ç»Ÿè®¡ APIï¼ˆ70 è¡Œï¼‰
â”‚   â”‚   â”œâ”€â”€ [id]/
â”‚   â”‚   â”‚   â”œâ”€â”€ stats.get.ts               # å•ä¸ªç»Ÿè®¡ APIï¼ˆ50 è¡Œï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ increment-view.post.ts     # å¢åŠ é˜…è¯»é‡ APIï¼ˆ50 è¡Œï¼‰
â”‚   â”‚   â”œâ”€â”€ hot.get.ts                     # çƒ­é—¨æ–‡ç«  APIï¼ˆ100 è¡Œï¼‰
â”‚   â”‚   â””â”€â”€ list.get.ts                    # æ–‡ç« åˆ—è¡¨ APIï¼ˆ120 è¡Œï¼‰
â”‚   â””â”€â”€ cache/
â”‚       â”œâ”€â”€ invalidate.post.ts             # æ¸…é™¤ç¼“å­˜ APIï¼ˆ60 è¡Œï¼‰
â”‚       â””â”€â”€ stats.get.ts                   # ç¼“å­˜ç»Ÿè®¡ APIï¼ˆ30 è¡Œï¼‰
```

### å®¢æˆ·ç«¯æ–‡ä»¶

```
composables/
â””â”€â”€ useCache.ts                             # å®¢æˆ·ç«¯ composablesï¼ˆ230 è¡Œï¼‰
```

### æ–‡æ¡£æ–‡ä»¶

```
doc/
â”œâ”€â”€ CACHE_IMPLEMENTATION.md                 # å®Œæ•´å®ç°æ–‡æ¡£ï¼ˆ600+ è¡Œï¼‰
â”œâ”€â”€ CACHE_USAGE_EXAMPLES.md                 # ä½¿ç”¨ç¤ºä¾‹ï¼ˆ800+ è¡Œï¼‰
â”œâ”€â”€ CACHE_QUICK_START.md                    # å¿«é€Ÿå…¥é—¨ï¼ˆ500+ è¡Œï¼‰
â””â”€â”€ CACHE_SUMMARY.md                        # å®ç°æ€»ç»“ï¼ˆæœ¬æ–‡æ¡£ï¼‰
```

**æ€»ä»£ç é‡**: ~860 è¡Œï¼ˆä¸å«æ–‡æ¡£ï¼‰  
**æ€»æ–‡æ¡£é‡**: ~2000 è¡Œ

---

## ğŸ”§ ä½¿ç”¨æ–¹å¼

### å¿«é€Ÿé›†æˆï¼ˆ3 æ­¥ï¼‰

#### 1. è·å–æ–‡ç« ç»Ÿè®¡

```typescript
import { usePostStats } from '~/composables/useCache'

const { getStats } = usePostStats()
const stats = await getStats(postId)
// { likeCount: 10, commentCount: 5, viewCount: 100 }
```

#### 2. è·å–çƒ­é—¨æ–‡ç« 

```typescript
import { useCachedHotPosts } from '~/composables/useCache'

const { posts, fetchHotPosts } = useCachedHotPosts()
await fetchHotPosts(10, 30)
```

#### 3. æ¸…é™¤ç¼“å­˜

```typescript
import { useCacheManager } from '~/composables/useCache'

const { invalidatePost } = useCacheManager()
await invalidatePost(postId)
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. Vercel Serverless é™åˆ¶

- âœ… åŒä¸€å®ä¾‹å†…è¯·æ±‚å¯ä»¥å…±äº«ç¼“å­˜
- âŒ ä¸åŒå®ä¾‹ä¹‹é—´ç¼“å­˜ä¸å…±äº«
- âœ… å¯¹ä¸­å°å‹åšå®¢å½±å“ä¸å¤§

### 2. æ•°æ®ä¸€è‡´æ€§

- âœ… è®¾ç½®åˆç†çš„ TTLï¼ˆ1-5 åˆ†é’Ÿï¼‰
- âœ… æ•°æ®æ›´æ–°æ—¶ä¸»åŠ¨æ¸…é™¤ç¼“å­˜
- âœ… å…è®¸çŸ­æš‚çš„æ•°æ®å»¶è¿Ÿ

### 3. å†…å­˜ä½¿ç”¨

- âœ… LRU è‡ªåŠ¨æ·˜æ±°æ—§æ•°æ®
- âœ… é»˜è®¤æœ€å¤§ 1000 æ¡ç›®
- âœ… é¢„è®¡å ç”¨ 10-50MB

---

## ğŸ”® æœªæ¥æ‰©å±•

### å‡çº§è·¯å¾„

å½“åšå®¢æµé‡å¢é•¿åˆ°ä¸€å®šè§„æ¨¡ï¼ˆæ—¥ PV > 10ä¸‡ï¼‰æ—¶ï¼Œå¯ä»¥è€ƒè™‘ï¼š

1. **å¼•å…¥ Redis**
   - Upstash Redisï¼ˆServerlessï¼Œ$0-10/æœˆï¼‰
   - Railway Redisï¼ˆ$5/æœˆèµ·ï¼‰
   - Vercel KVï¼ˆåŸºäº Upstashï¼‰

2. **æ•°æ®åº“ä¼˜åŒ–**
   - æ·»åŠ ç»Ÿè®¡å­—æ®µï¼ˆ`like_count`, `comment_count`ï¼‰
   - ä½¿ç”¨è§¦å‘å™¨è‡ªåŠ¨æ›´æ–°
   - åˆ›å»ºç´¢å¼•

3. **CDN ç¼“å­˜**
   - Vercel Edge Cache
   - CloudFlare CDN
   - é™æ€é¡µé¢ç¼“å­˜

### è¿ç§»æˆæœ¬

- **å¼€å‘æ—¶é—´**: 1-2 å¤©
- **é¢å¤–æˆæœ¬**: $5-10/æœˆï¼ˆRedisï¼‰
- **ä»£ç æ”¹åŠ¨**: ä¸»è¦åœ¨ `server/utils/cache.ts`

---

## ğŸ“ˆ ç›‘æ§å’Œè°ƒè¯•

### æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡

```typescript
import { useCacheManager } from '~/composables/useCache'

const { getCacheStats } = useCacheManager()
const stats = await getCacheStats()
// { size: 150, maxSize: 1000, usagePercentage: '15.00%' }
```

### æ€§èƒ½æµ‹è¯•

```javascript
console.time('First Request')
await fetch('/api/posts/hot?limit=10')
console.timeEnd('First Request') // ~245ms

console.time('Second Request (Cached)')
await fetch('/api/posts/hot?limit=10')
console.timeEnd('Second Request (Cached)') // ~8ms
```

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. é€‰æ‹©åˆé€‚çš„ç¼“å­˜ç­–ç•¥

- âœ… é¢‘ç¹è®¿é—®çš„æ•°æ®ï¼šä½¿ç”¨ç¼“å­˜
- âœ… å˜åŒ–ä¸é¢‘ç¹çš„æ•°æ®ï¼šä½¿ç”¨è¾ƒé•¿ TTL
- âŒ ç”¨æˆ·ç§æœ‰æ•°æ®ï¼šä¸å»ºè®®ç¼“å­˜
- âŒ å®æ—¶æ€§è¦æ±‚é«˜çš„æ•°æ®ï¼šä¸å»ºè®®ç¼“å­˜

### 2. åŠæ—¶æ¸…é™¤ç¼“å­˜

```typescript
// âœ… æ­£ç¡®ï¼šæ›´æ–°åç«‹å³æ¸…é™¤
await updatePost(postId)
await invalidatePost(postId)

// âŒ é”™è¯¯ï¼šå¿˜è®°æ¸…é™¤ç¼“å­˜
await updatePost(postId)
// æ•°æ®ä¸ä¸€è‡´ï¼
```

### 3. ä¼˜é›…é™çº§

```typescript
try {
  const stats = await getStats(postId)
} catch (error) {
  // é™çº§å¤„ç†
  const stats = { likeCount: 0, commentCount: 0, viewCount: 0 }
}
```

---

## ğŸ“š ç›¸å…³èµ„æº

### æ–‡æ¡£

- [å®Œæ•´å®ç°æ–‡æ¡£](./CACHE_IMPLEMENTATION.md)
- [ä½¿ç”¨ç¤ºä¾‹](./CACHE_USAGE_EXAMPLES.md)
- [å¿«é€Ÿå…¥é—¨](./CACHE_QUICK_START.md)

### æŠ€æœ¯æ–‡æ¡£

- [LRU Cache GitHub](https://github.com/isaacs/node-lru-cache)
- [Nuxt Server API](https://nuxt.com/docs/guide/directory-structure/server)
- [Supabase æ–‡æ¡£](https://supabase.com/docs)

---

## ğŸ‰ æ€»ç»“

### æ ¸å¿ƒæˆæœ

âœ… **å®Œæ•´çš„ç¼“å­˜ç³»ç»Ÿ**

- æœåŠ¡ç«¯ APIï¼ˆ7 ä¸ªç«¯ç‚¹ï¼‰
- å®¢æˆ·ç«¯ Composablesï¼ˆ4 ä¸ªï¼‰
- å®Œå–„çš„æ–‡æ¡£ï¼ˆ4 ç¯‡ï¼‰

âœ… **æ˜¾è‘—çš„æ€§èƒ½æå‡**

- æ•°æ®åº“æŸ¥è¯¢å‡å°‘ 80-90%
- API å“åº”é€Ÿåº¦æå‡ 95%+
- é¦–é¡µåŠ è½½æ—¶é—´å‡å°‘ 70%+

âœ… **é›¶åŸºç¡€è®¾æ–½æˆæœ¬**

- æ— éœ€ Redis
- æ— éœ€ä¿®æ”¹æ•°æ®åº“
- é€‚åˆä¸­å°å‹åšå®¢

âœ… **ä¼˜ç§€çš„å¼€å‘ä½“éªŒ**

- API ç®€å•æ˜“ç”¨
- æ–‡æ¡£å®Œå–„
- æ˜“äºç»´æŠ¤å’Œæ‰©å±•

### é€‚ç”¨åœºæ™¯

âœ… **éå¸¸é€‚åˆ**:

- ä¸­å°å‹åšå®¢ï¼ˆæ—¥ PV < 10ä¸‡ï¼‰
- é¢„ç®—æœ‰é™çš„é¡¹ç›®
- å¿«é€Ÿè¿­ä»£çš„é¡¹ç›®

âš ï¸ **éœ€è¦æ³¨æ„**:

- Vercel Serverless ç¯å¢ƒç¼“å­˜å‘½ä¸­ç‡è¾ƒä½
- ä¸é€‚åˆè¶…å¤§æµé‡ç½‘ç«™
- éœ€è¦å®šæœŸç›‘æ§ç¼“å­˜æ•ˆæœ

### ä¸‹ä¸€æ­¥

1. **é›†æˆåˆ°ç°æœ‰é¡µé¢** - ä½¿ç”¨ç¼“å­˜ API æ›¿æ¢ç›´æ¥æ•°æ®åº“æŸ¥è¯¢
2. **ç›‘æ§æ•ˆæœ** - å®šæœŸæŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡å’Œæ€§èƒ½æŒ‡æ ‡
3. **æŒç»­ä¼˜åŒ–** - æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ TTL å’Œç¼“å­˜ç­–ç•¥
4. **è€ƒè™‘å‡çº§** - æµé‡å¢é•¿æ—¶å‡çº§åˆ° Redis

---

**åˆ›å»ºæ—¶é—´**: 2026-01-07  
**ç»´æŠ¤äººå‘˜**: Tech Blog Team  
**çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶å¯æŠ•å…¥ä½¿ç”¨
