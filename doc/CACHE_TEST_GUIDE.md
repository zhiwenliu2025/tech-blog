# ğŸ§ª ç¼“å­˜ç³»ç»Ÿæµ‹è¯•æŒ‡å—

## å¿«é€ŸéªŒè¯ç¼“å­˜æ˜¯å¦å·¥ä½œ

### æµ‹è¯• 1: çƒ­é—¨æ–‡ç« ç¼“å­˜

1. **ç¬¬ä¸€æ¬¡è®¿é—®ï¼ˆå†·å¯åŠ¨ï¼‰**

```bash
curl -i http://localhost:3000/api/posts/hot?limit=5
```

æŸ¥çœ‹å“åº”ï¼š

```json
{
  "success": true,
  "data": [...],
  "cached": false  // âŒ ç¬¬ä¸€æ¬¡ï¼Œä»æ•°æ®åº“æŸ¥è¯¢
}
```

2. **ç¬¬äºŒæ¬¡è®¿é—®ï¼ˆ1åˆ†é’Ÿå†…ï¼‰**

```bash
curl -i http://localhost:3000/api/posts/hot?limit=5
```

æŸ¥çœ‹å“åº”ï¼š

```json
{
  "success": true,
  "data": [...],
  "cached": true   // âœ… å‘½ä¸­ç¼“å­˜ï¼
}
```

---

### æµ‹è¯• 2: æ–‡ç« ç»Ÿè®¡ç¼“å­˜

1. **è·å–æ–‡ç« ç»Ÿè®¡**

```bash
# æ›¿æ¢ POST_ID ä¸ºå®é™…æ–‡ç« ID
curl http://localhost:3000/api/posts/POST_ID/stats
```

å“åº”ï¼š

```json
{
  "success": true,
  "data": {
    "likeCount": 10,
    "commentCount": 5,
    "viewCount": 100
  },
  "cached": false // ç¬¬ä¸€æ¬¡
}
```

2. **å†æ¬¡è¯·æ±‚ï¼ˆ1åˆ†é’Ÿå†…ï¼‰**

```bash
curl http://localhost:3000/api/posts/POST_ID/stats
```

å“åº”ï¼š

```json
{
  "success": true,
  "data": {
    "likeCount": 10,
    "commentCount": 5,
    "viewCount": 100
  },
  "cached": true // âœ… ä»ç¼“å­˜è·å–
}
```

---

### æµ‹è¯• 3: ç¼“å­˜å¤±æ•ˆæœºåˆ¶

1. **å¢åŠ é˜…è¯»é‡ï¼ˆä¼šæ¸…é™¤ç¼“å­˜ï¼‰**

```bash
curl -X POST http://localhost:3000/api/posts/POST_ID/increment-view
```

2. **å†æ¬¡è·å–ç»Ÿè®¡**

```bash
curl http://localhost:3000/api/posts/POST_ID/stats
```

å“åº”åº”è¯¥æ˜¾ç¤ºï¼š

```json
{
  "success": true,
  "data": {
    "likeCount": 10,
    "commentCount": 5,
    "viewCount": 101 // âœ… é˜…è¯»é‡å¢åŠ äº†
  },
  "cached": false // âŒ ç¼“å­˜å·²æ¸…é™¤ï¼Œé‡æ–°æŸ¥è¯¢
}
```

---

### æµ‹è¯• 4: æ‰¹é‡è·å–ç»Ÿè®¡

```bash
curl "http://localhost:3000/api/posts/stats?postIds=id1,id2,id3"
```

å“åº”ï¼š

```json
{
  "success": true,
  "data": [
    {
      "postId": "id1",
      "likeCount": 10,
      "commentCount": 5,
      "viewCount": 100,
      "fromCache": true // âœ… å¦‚æœä¹‹å‰è¯·æ±‚è¿‡
    },
    {
      "postId": "id2",
      "likeCount": 20,
      "commentCount": 8,
      "viewCount": 200,
      "fromCache": false // âŒ ç¬¬ä¸€æ¬¡è¯·æ±‚
    }
  ]
}
```

---

### æµ‹è¯• 5: æ–‡ç« åˆ—è¡¨ç¼“å­˜

```bash
curl "http://localhost:3000/api/posts/list?page=1&limit=10"
```

å“åº”ï¼š

```json
{
  "success": true,
  "data": {
    "posts": [...],
    "total": 50,
    "page": 1,
    "limit": 10,
    "totalPages": 5
  },
  "cached": false  // ç¬¬ä¸€æ¬¡
}
```

å†æ¬¡è¯·æ±‚ï¼ˆ2åˆ†é’Ÿå†…ï¼‰ï¼š

```json
{
  "cached": true // âœ… ä»ç¼“å­˜è·å–
}
```

---

### æµ‹è¯• 6: æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡

```bash
curl http://localhost:3000/api/cache/stats
```

å“åº”ç¤ºä¾‹ï¼š

```json
{
  "success": true,
  "data": {
    "size": 25, // å½“å‰ç¼“å­˜æ¡ç›®æ•°
    "maxSize": 1000, // æœ€å¤§å®¹é‡
    "keys": ["hot_posts:5:30", "post_stats:abc123", "post_stats:def456", "posts_list:1:10:::"]
  }
}
```

---

### æµ‹è¯• 7: æ¸…é™¤æ‰€æœ‰ç¼“å­˜

```bash
curl -X POST http://localhost:3000/api/cache/invalidate \
  -H "Content-Type: application/json" \
  -d '{"type": "all"}'
```

å“åº”ï¼š

```json
{
  "success": true,
  "message": "All cache cleared"
}
```

---

### æµ‹è¯• 8: æ¸…é™¤ç‰¹å®šæ–‡ç« ç¼“å­˜

```bash
curl -X POST http://localhost:3000/api/cache/invalidate \
  -H "Content-Type: application/json" \
  -d '{"type": "post", "postId": "POST_ID"}'
```

---

## ğŸ–¥ï¸ æµè§ˆå™¨æµ‹è¯•

### æµ‹è¯•çƒ­é—¨æ–‡ç« ç»„ä»¶

1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. è®¿é—®é¦–é¡µ `http://localhost:3000`
3. æŸ¥çœ‹ Network æ ‡ç­¾
4. æ‰¾åˆ° `/api/posts/hot` è¯·æ±‚
5. åˆ·æ–°é¡µé¢ï¼Œç¬¬äºŒæ¬¡è¯·æ±‚åº”è¯¥æ›´å¿«ï¼ˆä»ç¼“å­˜ï¼‰

### æµ‹è¯•æ–‡ç« è¯¦æƒ…é¡µ

1. è®¿é—®æ–‡ç« è¯¦æƒ…é¡µ `http://localhost:3000/blog/[slug]`
2. æŸ¥çœ‹ Network æ ‡ç­¾
3. æ‰¾åˆ° `/api/posts/[id]/stats` è¯·æ±‚
4. åˆ·æ–°é¡µé¢ï¼Œåº”è¯¥æ˜¾ç¤º `cached: true`

### æµ‹è¯•ç¼“å­˜å¤±æ•ˆ

1. åœ¨æ–‡ç« è¯¦æƒ…é¡µç‚¹èµ
2. æŸ¥çœ‹ Network æ ‡ç­¾
3. åº”è¯¥çœ‹åˆ°ï¼š
   - `POST /api/posts/[id]/increment-view`ï¼ˆæ¸…é™¤ç¼“å­˜ï¼‰
   - `GET /api/posts/[id]/stats`ï¼ˆé‡æ–°è·å–ï¼Œcached: falseï¼‰

---

## ğŸ“Š æ€§èƒ½æµ‹è¯•

### ä½¿ç”¨ Apache Bench

```bash
# æµ‹è¯•çƒ­é—¨æ–‡ç« APIï¼ˆ100ä¸ªè¯·æ±‚ï¼Œ10ä¸ªå¹¶å‘ï¼‰
ab -n 100 -c 10 http://localhost:3000/api/posts/hot?limit=5

# æŸ¥çœ‹ç»“æœ
# Time per request: 50ms (cached) vs 600ms (uncached)
# æ€§èƒ½æå‡çº¦ 92%
```

### ä½¿ç”¨ wrk

```bash
# æµ‹è¯• 30 ç§’ï¼Œ10 ä¸ªå¹¶å‘è¿æ¥
wrk -t10 -c10 -d30s http://localhost:3000/api/posts/hot?limit=5

# æŸ¥çœ‹ QPS (Queries Per Second)
# ç¼“å­˜å‰: ~50 QPS
# ç¼“å­˜å: ~500 QPS
# æ€§èƒ½æå‡ 10å€
```

---

## âœ… é¢„æœŸç»“æœ

### ç¼“å­˜å‘½ä¸­æƒ…å†µ

| API ç«¯ç‚¹                | ç¬¬1æ¬¡   | ç¬¬2æ¬¡ï¼ˆTTLå†…ï¼‰ | ç¬¬3æ¬¡ï¼ˆTTLå¤–ï¼‰ |
| ----------------------- | ------- | -------------- | -------------- |
| `/api/posts/hot`        | âŒ Miss | âœ… Hit         | âŒ Miss        |
| `/api/posts/[id]/stats` | âŒ Miss | âœ… Hit         | âŒ Miss        |
| `/api/posts/list`       | âŒ Miss | âœ… Hit         | âŒ Miss        |

### å“åº”æ—¶é—´

| åœºæ™¯     | æœªç¼“å­˜ | ç¼“å­˜å‘½ä¸­ | æå‡       |
| -------- | ------ | -------- | ---------- |
| çƒ­é—¨æ–‡ç«  | 600ms  | 50ms     | **92%** â¬‡ï¸ |
| æ–‡ç« ç»Ÿè®¡ | 400ms  | 30ms     | **92%** â¬‡ï¸ |
| æ–‡ç« åˆ—è¡¨ | 700ms  | 60ms     | **91%** â¬‡ï¸ |

---

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—

ç¼“å­˜APIä¼šè¾“å‡ºæ—¥å¿—ï¼š

```bash
# ç¼“å­˜å‘½ä¸­
Cache hit: hot_posts:5:30

# ç¼“å­˜æœªå‘½ä¸­
Cache miss: hot_posts:5:30

# ç¼“å­˜å†™å…¥
Cache set: hot_posts:5:30 (TTL: 300s)

# ç¼“å­˜æ¸…é™¤
Cache invalidated: post_stats:abc123
```

### 2. ä½¿ç”¨æµè§ˆå™¨æ‰©å±•

æ¨èä½¿ç”¨ **Vue DevTools** æŸ¥çœ‹ï¼š

- ç»„ä»¶çŠ¶æ€
- æ•°æ®æ›´æ–°
- æ€§èƒ½æŒ‡æ ‡

### 3. ç›‘æ§ç½‘ç»œè¯·æ±‚

åœ¨ DevTools Network æ ‡ç­¾ä¸­ï¼š

- æŸ¥çœ‹å“åº”æ—¶é—´
- æ£€æŸ¥ `cached` å­—æ®µ
- ç›‘æ§è¯·æ±‚é¢‘ç‡

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: ç¼“å­˜æ²¡æœ‰ç”Ÿæ•ˆ

**ç—‡çŠ¶ï¼š** æ¯æ¬¡è¯·æ±‚éƒ½è¿”å› `cached: false`

**å¯èƒ½åŸå› ï¼š**

- ç¼“å­˜æœåŠ¡æœªå¯åŠ¨
- TTL è®¾ç½®ä¸º 0
- ç¼“å­˜é”®ç”Ÿæˆé”™è¯¯

**è§£å†³æ–¹æ³•ï¼š**

```bash
# æ£€æŸ¥ç¼“å­˜ç»Ÿè®¡
curl http://localhost:3000/api/cache/stats

# æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
# åº”è¯¥çœ‹åˆ° "Cache set: ..." æ—¥å¿—
```

### é—®é¢˜ 2: æ•°æ®ä¸æ›´æ–°

**ç—‡çŠ¶ï¼š** æ›´æ–°æ•°æ®åï¼Œå‰ç«¯æ˜¾ç¤ºæ—§æ•°æ®

**å¯èƒ½åŸå› ï¼š**

- ç¼“å­˜å¤±æ•ˆæœºåˆ¶æœªè§¦å‘
- TTL è®¾ç½®è¿‡é•¿

**è§£å†³æ–¹æ³•ï¼š**

```bash
# æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜
curl -X POST http://localhost:3000/api/cache/invalidate \
  -H "Content-Type: application/json" \
  -d '{"type": "all"}'
```

### é—®é¢˜ 3: å†…å­˜å ç”¨è¿‡é«˜

**ç—‡çŠ¶ï¼š** æœåŠ¡å™¨å†…å­˜æŒç»­å¢é•¿

**å¯èƒ½åŸå› ï¼š**

- ç¼“å­˜æ¡ç›®è¿‡å¤š
- LRU æ¸…ç†æœªç”Ÿæ•ˆ

**è§£å†³æ–¹æ³•ï¼š**

```typescript
// è°ƒæ•´ç¼“å­˜å¤§å° (server/utils/cache.ts)
const serverCache = new LRUCache<string, any>({
  max: 500, // ä» 1000 å‡å°‘åˆ° 500
  ttl: 1000 * 60 * 5
})
```

---

## ğŸ“ˆ ç›‘æ§æŒ‡æ ‡

### å…³é”®æŒ‡æ ‡

1. **ç¼“å­˜å‘½ä¸­ç‡**
   - ç›®æ ‡: > 80%
   - è®¡ç®—: (å‘½ä¸­æ¬¡æ•° / æ€»è¯·æ±‚æ¬¡æ•°) Ã— 100%

2. **å¹³å‡å“åº”æ—¶é—´**
   - ç¼“å­˜å‘½ä¸­: < 100ms
   - ç¼“å­˜æœªå‘½ä¸­: < 1000ms

3. **ç¼“å­˜æ¡ç›®æ•°**
   - æ­£å¸¸: 50-500
   - è­¦å‘Š: > 800
   - å±é™©: > 1000 (ä¼šè§¦å‘ LRU æ¸…ç†)

### ç›‘æ§å·¥å…·

æ¨èä½¿ç”¨ï¼š

- **Prometheus + Grafana**: å®æ—¶ç›‘æ§
- **New Relic**: APM ç›‘æ§
- **Datadog**: å…¨æ ˆç›‘æ§

---

## ğŸ¯ æµ‹è¯•æ¸…å•

å®Œæˆä»¥ä¸‹æµ‹è¯•åï¼Œç¼“å­˜ç³»ç»Ÿå³å¯ä¸Šçº¿ï¼š

- [ ] çƒ­é—¨æ–‡ç« ç¼“å­˜æµ‹è¯•
- [ ] æ–‡ç« ç»Ÿè®¡ç¼“å­˜æµ‹è¯•
- [ ] æ–‡ç« åˆ—è¡¨ç¼“å­˜æµ‹è¯•
- [ ] ç¼“å­˜å¤±æ•ˆæµ‹è¯•ï¼ˆç‚¹èµ/è¯„è®ºï¼‰
- [ ] æ‰¹é‡è·å–ç»Ÿè®¡æµ‹è¯•
- [ ] ç¼“å­˜ç»Ÿè®¡APIæµ‹è¯•
- [ ] æ¸…é™¤ç¼“å­˜æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•ï¼ˆAB/wrkï¼‰
- [ ] æµè§ˆå™¨ç«¯æµ‹è¯•
- [ ] å¹¶å‘æµ‹è¯•

---

## ğŸš€ ä¸Šçº¿æ£€æŸ¥

1. âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
2. âœ… æ—  linter é”™è¯¯
3. âœ… å“åº”æ—¶é—´è¾¾æ ‡
4. âœ… ç¼“å­˜å‘½ä¸­ç‡ > 80%
5. âœ… å†…å­˜å ç”¨æ­£å¸¸
6. âœ… æ—¥å¿—è¾“å‡ºæ­£å¸¸

**ä¸€åˆ‡å°±ç»ªï¼Œå¯ä»¥å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒï¼** ğŸ‰
