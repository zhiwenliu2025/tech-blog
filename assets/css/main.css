@tailwind base;
@tailwind components;
@tailwind utilities;

/* 自定义基础样式 */
@layer base {
  html {
    scroll-behavior: smooth;
    /* 移动端优化 */
    -webkit-text-size-adjust: 100%;
    -webkit-tap-highlight-color: transparent;
    /* 防止 iOS Safari 的橡皮筋效果 */
    overscroll-behavior-y: contain;
  }
  
  body {
    @apply font-sans antialiased;
    /* 移动端触摸优化 */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    /* 防止文本选择时的蓝色高亮（移动端） */
    -webkit-touch-callout: none;
    /* 改善触摸响应 */
    touch-action: manipulation;
  }
  
  /* 暗色模式变量 */
  .dark {
    color-scheme: dark;
  }
  
  /* 移动端按钮和链接触摸优化 */
  button,
  a,
  [role="button"] {
    /* 移除移动端点击高亮 */
    -webkit-tap-highlight-color: transparent;
    /* 改善触摸响应 */
    touch-action: manipulation;
    /* 防止双击缩放 */
    -ms-touch-action: manipulation;
    /* 确保最小触摸区域（44x44px 是 Apple 和 Google 推荐的最小尺寸） */
    min-height: 44px;
    min-width: 44px;
    /* 改善触摸反馈 */
    transition: background-color 0.15s ease, transform 0.1s ease, opacity 0.15s ease;
    /* 防止文本选择 */
    -webkit-user-select: none;
    user-select: none;
  }

  /* 移动端触摸反馈 - active 状态 */
  @media (hover: none) and (pointer: coarse) {
    button:active,
    a:active,
    [role="button"]:active {
      transform: scale(0.97);
      opacity: 0.8;
    }
  }
  
  /* 输入框移动端优化 */
  input,
  textarea,
  select {
    /* 移除 iOS Safari 的默认样式 */
    -webkit-appearance: none;
    /* 改善触摸响应 */
    touch-action: manipulation;
    /* 防止 iOS 自动缩放 */
    font-size: 16px;
  }
  
  /* 移动端滚动优化 */
  @media (max-width: 768px) {
    * {
      /* 改善滚动性能 */
      -webkit-overflow-scrolling: touch;
    }

    /* 改善滚动容器 */
    [data-scroll],
    .scroll-container,
    main,
    article {
      /* 平滑滚动 */
      scroll-behavior: smooth;
      /* 触摸滚动优化 */
      -webkit-overflow-scrolling: touch;
      /* 防止滚动链 */
      overscroll-behavior: contain;
    }

    /* 防止移动端长按选择 */
    img {
      -webkit-user-select: none;
      user-select: none;
      /* 允许图片点击，但不允许长按菜单 */
      pointer-events: auto;
      -webkit-touch-callout: none;
    }

    /* 允许交互元素的选择 */
    input,
    textarea,
    [contenteditable] {
      -webkit-user-select: text;
      user-select: text;
      /* 改善输入框触摸体验 */
      touch-action: manipulation;
    }

    /* 卡片和列表项触摸优化 */
    .card,
    [class*="card"],
    article,
    [role="article"] {
      /* 改善触摸响应 */
      touch-action: pan-y;
      /* 触摸反馈 */
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    /* 列表项触摸反馈 */
    li:active,
    .card:active,
    [class*="card"]:active {
      transform: scale(0.98);
    }

    /* 改善链接触摸体验 */
    a {
      /* 确保链接有足够的触摸区域 */
      display: inline-block;
      padding: 0.25rem 0.5rem;
      margin: -0.25rem -0.5rem;
      /* 触摸反馈 */
      transition: color 0.15s ease, background-color 0.15s ease;
    }

    /* 改善按钮触摸体验 */
    button {
      /* 确保按钮有足够的触摸区域 */
      padding: 0.75rem 1.5rem;
      /* 触摸反馈 */
      position: relative;
      overflow: hidden;
    }

    /* 触摸时的波纹效果（可选） */
    button::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.3s ease, height 0.3s ease;
    }

    button:active::after {
      width: 300px;
      height: 300px;
    }
  }
}

/* 自定义组件样式 */
@layer components {
  /* 按钮样式 */
  .btn {
    @apply inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors duration-200;
  }
  
  .btn-primary {
    @apply bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500;
  }
  
  .btn-secondary {
    @apply bg-gray-600 text-white hover:bg-gray-700 focus:ring-gray-500;
  }
  
  .btn-outline {
    @apply border-gray-300 text-gray-700 bg-white hover:bg-gray-50 focus:ring-primary-500;
  }
  
  .btn-dark {
    @apply bg-dark-800 text-gray-100 hover:bg-dark-700 focus:ring-primary-500;
  }
  
  /* 卡片样式 */
  .card {
    @apply bg-white dark:bg-dark-800 rounded-lg shadow-md overflow-hidden;
  }
  
  .card-header {
    @apply px-6 py-4 border-b border-gray-200 dark:border-dark-700;
  }
  
  .card-body {
    @apply px-6 py-4;
  }
  
  .card-footer {
    @apply px-6 py-4 bg-gray-50 dark:bg-dark-900 border-t border-gray-200 dark:border-dark-700;
  }
  
  /* 输入框样式 */
  .form-input {
    @apply block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-dark-700 dark:border-dark-600 dark:text-white dark:placeholder-gray-400;
  }
  
  .form-textarea {
    @apply form-input resize-vertical;
  }
  
  /* 导航样式 */
  .nav-link {
    @apply px-3 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-200 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-gray-100 dark:hover:bg-dark-700;
  }
  
  .nav-link-active {
    @apply nav-link bg-primary-50 dark:bg-dark-700 text-primary-600 dark:text-primary-400;
  }
  
  /* 代码块样式 */
  .prose pre {
    @apply rounded-lg;
  }
  
  .prose code:not(pre code) {
    @apply px-1 py-0.5 bg-gray-100 dark:bg-dark-700 text-primary-600 dark:text-primary-400 rounded text-sm;
  }
  
  /* 标签样式 */
  .tag {
    @apply inline-block px-2 py-1 text-xs font-medium rounded-full bg-primary-100 text-primary-800 dark:bg-primary-900 dark:text-primary-200;
  }
  
  /* 分隔线样式 */
  .divider {
    @apply border-t border-gray-200 dark:border-dark-700 my-6;
  }
}

/* 自定义工具类 */
@layer utilities {
  .text-balance {
    text-wrap: balance;
  }
  
  /* 滚动条样式 */
  .scrollbar-thin {
    scrollbar-width: thin;
    scrollbar-color: rgb(156 163 175) rgb(243 244 246);
  }
  
  .scrollbar-thin::-webkit-scrollbar {
    width: 6px;
  }
  
  .scrollbar-thin::-webkit-scrollbar-track {
    background: rgb(243 244 246);
  }
  
  .scrollbar-thin::-webkit-scrollbar-thumb {
    background-color: rgb(156 163 175);
    border-radius: 3px;
  }
  
  .dark .scrollbar-thin {
    scrollbar-color: rgb(75 85 99) rgb(31 41 55);
  }
  
  .dark .scrollbar-thin::-webkit-scrollbar-track {
    background: rgb(31 41 55);
  }
  
  .dark .scrollbar-thin::-webkit-scrollbar-thumb {
    background-color: rgb(75 85 99);
  }
  
  /* 动画类 */
  .animate-fade-in {
    animation: fadeIn 0.5s ease-in-out;
  }
  
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* 响应式隐藏/显示 */
  .mobile-only {
    @apply block md:hidden;
  }
  
  .desktop-only {
    @apply hidden md:block;
  }
  
  /* 移动端触摸优化类 */
  .touch-optimized {
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    -ms-touch-action: manipulation;
    /* 确保最小触摸区域 */
    min-height: 44px;
    min-width: 44px;
    /* 触摸反馈 */
    transition: transform 0.1s ease, opacity 0.15s ease;
  }

  /* 触摸反馈类 */
  .touch-feedback:active {
    transform: scale(0.97);
    opacity: 0.8;
  }

  /* 触摸区域扩展类 */
  .touch-target {
    position: relative;
    min-height: 44px;
    min-width: 44px;
  }

  .touch-target::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    min-width: 44px;
    min-height: 44px;
    /* 扩展触摸区域但不影响布局 */
    padding: 0.5rem;
    margin: -0.5rem;
  }
  
  /* 移动端安全区域适配（iPhone X 等） */
  .safe-area-top {
    padding-top: env(safe-area-inset-top);
  }
  
  .safe-area-bottom {
    padding-bottom: env(safe-area-inset-bottom);
  }
  
  .safe-area-left {
    padding-left: env(safe-area-inset-left);
  }
  
  .safe-area-right {
    padding-right: env(safe-area-inset-right);
  }
  
  /* 移动端容器优化 */
  @media (max-width: 640px) {
    /* 小屏幕下的字体大小优化 */
    h1 {
      font-size: 1.75rem;
      line-height: 2rem;
    }
    
    h2 {
      font-size: 1.5rem;
      line-height: 1.75rem;
    }
    
    h3 {
      font-size: 1.25rem;
      line-height: 1.5rem;
    }
    
    /* 优化表格在小屏幕的显示 */
    table {
      font-size: 0.875rem;
      display: block;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    
    /* 优化代码块在小屏幕的显示 */
    pre {
      font-size: 0.75rem;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
  }
  
  /* 超小屏幕优化（< 375px） */
  @media (max-width: 374px) {
    /* 进一步减小字体 */
    h1 {
      font-size: 1.5rem;
      line-height: 1.75rem;
    }
    
    h2 {
      font-size: 1.25rem;
      line-height: 1.5rem;
    }
    
    /* 优化按钮和输入框 */
    button,
    input,
    select,
    textarea {
      font-size: 14px;
    }
  }
  
  /* 移动端滚动优化 */
  @media (max-width: 768px) {
    /* 优化滚动性能 */
    html {
      scroll-padding-top: 4rem;
    }
    
    /* 优化长列表的渲染性能 */
    .virtual-scroll {
      contain: layout style paint;
    }
  }
  
  /* 横屏模式优化 */
  @media (max-width: 768px) and (orientation: landscape) {
    /* 横屏时减小垂直间距 */
    main {
      padding-top: 1rem;
      padding-bottom: 1rem;
    }
    
    /* 横屏时优化 Header 高度 */
    header {
      height: auto;
      min-height: 3.5rem;
    }
  }
  }
  
  .safe-area-right {
    padding-right: env(safe-area-inset-right);
  }
  
  /* 移动端滚动优化 */
  .mobile-scroll {
    -webkit-overflow-scrolling: touch;
    overflow-scrolling: touch;
  }
  
  /* 防止移动端文本选择（用于按钮等） */
  .no-select {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    -webkit-touch-callout: none;
  }

  /* 触摸手势支持 */
  .swipeable {
    touch-action: pan-x pan-y;
    /* 改善滑动性能 */
    will-change: transform;
  }

  /* 水平滑动容器 */
  .swipe-horizontal {
    touch-action: pan-x;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scroll-snap-type: x mandatory;
  }

  .swipe-horizontal > * {
    scroll-snap-align: start;
  }

  /* 垂直滑动容器 */
  .swipe-vertical {
    touch-action: pan-y;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }

  /* 改善长按体验 */
  .long-press {
    touch-action: manipulation;
    -webkit-touch-callout: default;
  }

  /* 触摸延迟优化 */
  .touch-fast {
    touch-action: manipulation;
    /* 移除点击延迟 */
    -ms-touch-action: manipulation;
  }

  /* 移动端输入框优化 */
  @media (max-width: 768px) {
    input[type="text"],
    input[type="email"],
    input[type="password"],
    input[type="search"],
    input[type="tel"],
    input[type="url"],
    textarea {
      /* 防止 iOS 自动缩放 */
      font-size: 16px !important;
      /* 改善触摸体验 */
      touch-action: manipulation;
      /* 移除 iOS 默认样式 */
      -webkit-appearance: none;
      border-radius: 0.375rem;
    }

    /* 改善选择框触摸体验 */
    select {
      font-size: 16px !important;
      touch-action: manipulation;
      -webkit-appearance: none;
      padding: 0.75rem 2.5rem 0.75rem 1rem;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
      background-position: right 0.5rem center;
      background-repeat: no-repeat;
      background-size: 1.5em 1.5em;
    }

    /* 键盘输入优化 */
    /* 当输入框获得焦点时，确保页面可以正确滚动 */
    input:focus,
    textarea:focus {
      /* 确保输入框在视口中可见 */
      scroll-margin-top: 20px;
      scroll-margin-bottom: 20px;
    }

    /* 键盘打开时的页面优化 */
    /* iOS Safari 特殊处理：键盘打开时会改变视口高度 */
    @supports (-webkit-touch-callout: none) {
      /* iOS 设备 */
      body.keyboard-open {
        /* 防止页面在键盘打开时滚动 */
        position: fixed;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }
    }

    /* 键盘打开时的输入框容器优化 */
    .keyboard-input-container {
      /* 确保输入框容器有足够的空间 */
      padding-bottom: env(safe-area-inset-bottom, 0);
    }
  }
}

/* Highlight.js 代码高亮样式 - 使用深色主题 */
@import 'highlight.js/styles/github-dark.css';