@tailwind base;
@tailwind components;
@tailwind utilities;

/* è‡ªå®šä¹‰åŸºç¡€æ ·å¼ */
@layer base {
  html {
    scroll-behavior: smooth;
    /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
    -webkit-text-size-adjust: 100%;
    -webkit-tap-highlight-color: transparent;
    /* é˜²æ­¢ iOS Safari çš„æ©¡çš®ç­‹æ•ˆæœ */
    overscroll-behavior-y: contain;
  }
  
  body {
    @apply font-sans antialiased;
    /* ç§»åŠ¨ç«¯è§¦æ‘¸ä¼˜åŒ– */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    /* é˜²æ­¢æ–‡æœ¬é€‰æ‹©æ—¶çš„è“è‰²é«˜äº®ï¼ˆç§»åŠ¨ç«¯ï¼‰ */
    -webkit-touch-callout: none;
    /* æ”¹å–„è§¦æ‘¸å“åº” */
    touch-action: manipulation;
  }
  
  /* æš—è‰²æ¨¡å¼å˜é‡ */
  .dark {
    color-scheme: dark;
  }
  
  /* ç§»åŠ¨ç«¯æŒ‰é’®å’Œé“¾æ¥è§¦æ‘¸ä¼˜åŒ– */
  button,
  a,
  [role="button"] {
    /* ç§»é™¤ç§»åŠ¨ç«¯ç‚¹å‡»é«˜äº® */
    -webkit-tap-highlight-color: transparent;
    /* æ”¹å–„è§¦æ‘¸å“åº” */
    touch-action: manipulation;
    /* é˜²æ­¢åŒå‡»ç¼©æ”¾ */
    -ms-touch-action: manipulation;
    /* ç¡®ä¿æœ€å°è§¦æ‘¸åŒºåŸŸï¼ˆ44x44px æ˜¯ Apple å’Œ Google æ¨èçš„æœ€å°å°ºå¯¸ï¼‰ */
    min-height: 44px;
    min-width: 44px;
    /* æ”¹å–„è§¦æ‘¸åé¦ˆ */
    transition: background-color 0.15s ease, transform 0.1s ease, opacity 0.15s ease;
    /* é˜²æ­¢æ–‡æœ¬é€‰æ‹© */
    -webkit-user-select: none;
    user-select: none;
  }

  /* ç§»åŠ¨ç«¯è§¦æ‘¸åé¦ˆ - active çŠ¶æ€ */
  @media (hover: none) and (pointer: coarse) {
    button:active,
    a:active,
    [role="button"]:active {
      transform: scale(0.97);
      opacity: 0.8;
    }
  }
  
  /* è¾“å…¥æ¡†ç§»åŠ¨ç«¯ä¼˜åŒ– */
  input,
  textarea,
  select {
    /* ç§»é™¤ iOS Safari çš„é»˜è®¤æ ·å¼ */
    -webkit-appearance: none;
    /* æ”¹å–„è§¦æ‘¸å“åº” */
    touch-action: manipulation;
    /* é˜²æ­¢ iOS è‡ªåŠ¨ç¼©æ”¾ */
    font-size: 16px;
  }
  
  /* ç§»åŠ¨ç«¯æ»šåŠ¨ä¼˜åŒ– */
  @media (max-width: 768px) {
    * {
      /* æ”¹å–„æ»šåŠ¨æ€§èƒ½ */
      -webkit-overflow-scrolling: touch;
    }

    /* æ”¹å–„æ»šåŠ¨å®¹å™¨ */
    [data-scroll],
    .scroll-container,
    main,
    article {
      /* å¹³æ»‘æ»šåŠ¨ */
      scroll-behavior: smooth;
      /* è§¦æ‘¸æ»šåŠ¨ä¼˜åŒ– */
      -webkit-overflow-scrolling: touch;
      /* é˜²æ­¢æ»šåŠ¨é“¾ */
      overscroll-behavior: contain;
    }

    /* é˜²æ­¢ç§»åŠ¨ç«¯é•¿æŒ‰é€‰æ‹© */
    img {
      -webkit-user-select: none;
      user-select: none;
      /* å…è®¸å›¾ç‰‡ç‚¹å‡»ï¼Œä½†ä¸å…è®¸é•¿æŒ‰èœå• */
      pointer-events: auto;
      -webkit-touch-callout: none;
    }

    /* å…è®¸äº¤äº’å…ƒç´ çš„é€‰æ‹© */
    input,
    textarea,
    [contenteditable] {
      -webkit-user-select: text;
      user-select: text;
      /* æ”¹å–„è¾“å…¥æ¡†è§¦æ‘¸ä½“éªŒ */
      touch-action: manipulation;
    }

    /* å¡ç‰‡å’Œåˆ—è¡¨é¡¹è§¦æ‘¸ä¼˜åŒ– */
    .card,
    [class*="card"],
    article,
    [role="article"] {
      /* æ”¹å–„è§¦æ‘¸å“åº” */
      touch-action: pan-y;
      /* è§¦æ‘¸åé¦ˆ */
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    /* åˆ—è¡¨é¡¹è§¦æ‘¸åé¦ˆ */
    li:active,
    .card:active,
    [class*="card"]:active {
      transform: scale(0.98);
    }

    /* æ”¹å–„é“¾æ¥è§¦æ‘¸ä½“éªŒ */
    a {
      /* ç¡®ä¿é“¾æ¥æœ‰è¶³å¤Ÿçš„è§¦æ‘¸åŒºåŸŸ */
      display: inline-block;
      padding: 0.25rem 0.5rem;
      margin: -0.25rem -0.5rem;
      /* è§¦æ‘¸åé¦ˆ */
      transition: color 0.15s ease, background-color 0.15s ease;
    }

    /* æ”¹å–„æŒ‰é’®è§¦æ‘¸ä½“éªŒ */
    button {
      /* ç¡®ä¿æŒ‰é’®æœ‰è¶³å¤Ÿçš„è§¦æ‘¸åŒºåŸŸ */
      padding: 0.75rem 1.5rem;
      /* è§¦æ‘¸åé¦ˆ */
      position: relative;
      overflow: hidden;
    }

    /* è§¦æ‘¸æ—¶çš„æ³¢çº¹æ•ˆæœï¼ˆå¯é€‰ï¼‰ */
    button::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.3s ease, height 0.3s ease;
    }

    button:active::after {
      width: 300px;
      height: 300px;
    }
  }
}

/* è‡ªå®šä¹‰ç»„ä»¶æ ·å¼ */
@layer components {
  /* æŒ‰é’®æ ·å¼ */
  .btn {
    @apply inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors duration-200;
  }
  
  .btn-primary {
    @apply bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500;
  }
  
  .btn-secondary {
    @apply bg-gray-600 text-white hover:bg-gray-700 focus:ring-gray-500;
  }
  
  .btn-outline {
    @apply border-gray-300 text-gray-700 bg-white hover:bg-gray-50 focus:ring-primary-500;
  }
  
  .btn-dark {
    @apply bg-dark-800 text-gray-100 hover:bg-dark-700 focus:ring-primary-500;
  }
  
  /* å¡ç‰‡æ ·å¼ */
  .card {
    @apply bg-white dark:bg-dark-800 rounded-lg shadow-md overflow-hidden;
  }
  
  .card-header {
    @apply px-6 py-4 border-b border-gray-200 dark:border-dark-700;
  }
  
  .card-body {
    @apply px-6 py-4;
  }
  
  .card-footer {
    @apply px-6 py-4 bg-gray-50 dark:bg-dark-900 border-t border-gray-200 dark:border-dark-700;
  }
  
  /* è¾“å…¥æ¡†æ ·å¼ */
  .form-input {
    @apply block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-dark-700 dark:border-dark-600 dark:text-white dark:placeholder-gray-400;
  }
  
  .form-textarea {
    @apply form-input resize-vertical;
  }
  
  /* å¯¼èˆªæ ·å¼ */
  .nav-link {
    @apply px-3 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-200 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-gray-100 dark:hover:bg-dark-700;
  }
  
  .nav-link-active {
    @apply nav-link bg-primary-50 dark:bg-dark-700 text-primary-600 dark:text-primary-400;
  }
  
  /* ä»£ç å—æ ·å¼ */
  .prose pre {
    @apply rounded-lg;
  }
  
  .prose code:not(pre code) {
    @apply px-1 py-0.5 bg-gray-100 dark:bg-dark-700 text-primary-600 dark:text-primary-400 rounded text-sm;
  }
  
  /* æ ‡ç­¾æ ·å¼ */
  .tag {
    @apply inline-block px-2 py-1 text-xs font-medium rounded-full bg-primary-100 text-primary-800 dark:bg-primary-900 dark:text-primary-200;
  }
  
  /* åˆ†éš”çº¿æ ·å¼ */
  .divider {
    @apply border-t border-gray-200 dark:border-dark-700 my-6;
  }
}

/* è‡ªå®šä¹‰å·¥å…·ç±» */
@layer utilities {
  .text-balance {
    text-wrap: balance;
  }
  
  /* æ»šåŠ¨æ¡æ ·å¼ */
  .scrollbar-thin {
    scrollbar-width: thin;
    scrollbar-color: rgb(156 163 175) rgb(243 244 246);
  }
  
  .scrollbar-thin::-webkit-scrollbar {
    width: 6px;
  }
  
  .scrollbar-thin::-webkit-scrollbar-track {
    background: rgb(243 244 246);
  }
  
  .scrollbar-thin::-webkit-scrollbar-thumb {
    background-color: rgb(156 163 175);
    border-radius: 3px;
  }
  
  .dark .scrollbar-thin {
    scrollbar-color: rgb(75 85 99) rgb(31 41 55);
  }
  
  .dark .scrollbar-thin::-webkit-scrollbar-track {
    background: rgb(31 41 55);
  }
  
  .dark .scrollbar-thin::-webkit-scrollbar-thumb {
    background-color: rgb(75 85 99);
  }
  
  /* åŠ¨ç”»ç±» */
  .animate-fade-in {
    animation: fadeIn 0.5s ease-in-out;
  }
  
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* å“åº”å¼éšè—/æ˜¾ç¤º */
  .mobile-only {
    @apply block md:hidden;
  }
  
  .desktop-only {
    @apply hidden md:block;
  }
  
  /* ç§»åŠ¨ç«¯è§¦æ‘¸ä¼˜åŒ–ç±» */
  .touch-optimized {
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    -ms-touch-action: manipulation;
    /* ç¡®ä¿æœ€å°è§¦æ‘¸åŒºåŸŸ */
    min-height: 44px;
    min-width: 44px;
    /* è§¦æ‘¸åé¦ˆ */
    transition: transform 0.1s ease, opacity 0.15s ease;
  }

  /* è§¦æ‘¸åé¦ˆç±» */
  .touch-feedback:active {
    transform: scale(0.97);
    opacity: 0.8;
  }

  /* è§¦æ‘¸åŒºåŸŸæ‰©å±•ç±» */
  .touch-target {
    position: relative;
    min-height: 44px;
    min-width: 44px;
  }

  .touch-target::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    min-width: 44px;
    min-height: 44px;
    /* æ‰©å±•è§¦æ‘¸åŒºåŸŸä½†ä¸å½±å“å¸ƒå±€ */
    padding: 0.5rem;
    margin: -0.5rem;
  }
  
  /* Callout å‘Šç¤ºæ¡†æ ·å¼ */
  .callout {
    @apply rounded-lg border-l-4 p-4 my-6;
    @apply transition-all duration-200;
    @apply shadow-sm;
  }

  .callout-info {
    @apply border-blue-500 bg-blue-50 dark:bg-blue-950;
  }

  .callout-info::before {
    content: 'â„¹ï¸';
    @apply inline-block mr-2;
  }

  .callout-warning {
    @apply border-yellow-500 bg-yellow-50 dark:bg-yellow-950;
  }

  .callout-warning::before {
    content: 'âš ï¸';
    @apply inline-block mr-2;
  }

  .callout-error {
    @apply border-red-500 bg-red-50 dark:bg-red-950;
  }

  .callout-error::before {
    content: 'âŒ';
    @apply inline-block mr-2;
  }

  .callout-success {
    @apply border-green-500 bg-green-50 dark:bg-green-950;
  }

  .callout-success::before {
    content: 'âœ…';
    @apply inline-block mr-2;
  }

  .callout-tip {
    @apply border-purple-500 bg-purple-50 dark:bg-purple-950;
  }

  .callout-tip::before {
    content: 'ğŸ’¡';
    @apply inline-block mr-2;
  }

  .callout:hover {
    @apply shadow-md;
  }

  /* è§†é¢‘å®¹å™¨å“åº”å¼ */
  .video-container {
    @apply relative w-full overflow-hidden rounded-lg my-6;
    padding-bottom: 56.25%; /* 16:9 æ¯”ä¾‹ */
  }

  .video-container iframe,
  .video-container video {
    @apply absolute top-0 left-0 w-full h-full;
  }

  /* å›¾ç‰‡ç½‘æ ¼å¸ƒå±€ */
  .image-grid {
    @apply grid gap-4 my-6;
  }

  .image-grid-2 {
    @apply grid-cols-1 sm:grid-cols-2;
  }

  .image-grid-3 {
    @apply grid-cols-1 sm:grid-cols-2 md:grid-cols-3;
  }

  .image-grid-4 {
    @apply grid-cols-2 sm:grid-cols-3 md:grid-cols-4;
  }

  .image-grid img {
    @apply w-full h-full object-cover rounded-lg;
  }
  
  /* ç§»åŠ¨ç«¯å®‰å…¨åŒºåŸŸé€‚é…ï¼ˆiPhone X ç­‰ï¼‰ */
  .safe-area-top {
    padding-top: env(safe-area-inset-top);
  }
  
  .safe-area-bottom {
    padding-bottom: env(safe-area-inset-bottom);
  }
  
  .safe-area-left {
    padding-left: env(safe-area-inset-left);
  }
  
  .safe-area-right {
    padding-right: env(safe-area-inset-right);
  }
  
  /* ç§»åŠ¨ç«¯å®¹å™¨ä¼˜åŒ– */
  @media (max-width: 640px) {
    /* å°å±å¹•ä¸‹çš„å­—ä½“å¤§å°ä¼˜åŒ– */
    h1 {
      font-size: 1.75rem;
      line-height: 2rem;
    }
    
    h2 {
      font-size: 1.5rem;
      line-height: 1.75rem;
    }
    
    h3 {
      font-size: 1.25rem;
      line-height: 1.5rem;
    }
    
    /* ä¼˜åŒ–è¡¨æ ¼åœ¨å°å±å¹•çš„æ˜¾ç¤º - å“åº”å¼è¡¨æ ¼å®¹å™¨ */
    .prose table,
    .ProseMirror table {
      display: block;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      white-space: nowrap;
      /* æ·»åŠ æ»šåŠ¨æŒ‡ç¤ºå™¨ */
      background: linear-gradient(90deg, white 0%, transparent 5%, transparent 95%, white 100%);
      background-attachment: local, scroll;
    }

    .dark .prose table,
    .dark .ProseMirror table {
      background: linear-gradient(90deg, rgb(17 24 39) 0%, transparent 5%, transparent 95%, rgb(17 24 39) 100%);
    }

    /* è¡¨æ ¼æ»šåŠ¨æç¤º */
    table {
      position: relative;
    }

    table::after {
      content: 'â† æ»‘åŠ¨æŸ¥çœ‹æ›´å¤š â†’';
      position: absolute;
      bottom: -1.5rem;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.75rem;
      color: rgb(156 163 175);
      opacity: 0.7;
      white-space: nowrap;
    }
    
    /* ä¼˜åŒ–ä»£ç å—åœ¨å°å±å¹•çš„æ˜¾ç¤º */
    pre {
      font-size: 0.75rem;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    /* ä¼˜åŒ–å›¾ç‰‡ç½‘æ ¼åœ¨å°å±å¹• */
    .image-grid-3,
    .image-grid-4 {
      grid-template-columns: 1fr;
    }
  }
  
  /* è¶…å°å±å¹•ä¼˜åŒ–ï¼ˆ< 375pxï¼‰ */
  @media (max-width: 374px) {
    /* è¿›ä¸€æ­¥å‡å°å­—ä½“ */
    h1 {
      font-size: 1.5rem;
      line-height: 1.75rem;
    }
    
    h2 {
      font-size: 1.25rem;
      line-height: 1.5rem;
    }
    
    /* ä¼˜åŒ–æŒ‰é’®å’Œè¾“å…¥æ¡† */
    button,
    input,
    select,
    textarea {
      font-size: 14px;
    }
  }
  
  /* ç§»åŠ¨ç«¯æ»šåŠ¨ä¼˜åŒ– */
  @media (max-width: 768px) {
    /* ä¼˜åŒ–æ»šåŠ¨æ€§èƒ½ */
    html {
      scroll-padding-top: 4rem;
    }
    
    /* ä¼˜åŒ–é•¿åˆ—è¡¨çš„æ¸²æŸ“æ€§èƒ½ */
    .virtual-scroll {
      contain: layout style paint;
    }
  }
  
  /* æ¨ªå±æ¨¡å¼ä¼˜åŒ– */
  @media (max-width: 768px) and (orientation: landscape) {
    /* æ¨ªå±æ—¶å‡å°å‚ç›´é—´è· */
    main {
      padding-top: 1rem;
      padding-bottom: 1rem;
    }
    
    /* æ¨ªå±æ—¶ä¼˜åŒ– Header é«˜åº¦ */
    header {
      height: auto;
      min-height: 3.5rem;
    }
  }
  
  /* ç§»åŠ¨ç«¯æ»šåŠ¨ä¼˜åŒ– */
  .mobile-scroll {
    -webkit-overflow-scrolling: touch;
    overflow-scrolling: touch;
  }
  
  /* é˜²æ­¢ç§»åŠ¨ç«¯æ–‡æœ¬é€‰æ‹©ï¼ˆç”¨äºæŒ‰é’®ç­‰ï¼‰ */
  .no-select {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    -webkit-touch-callout: none;
  }

  /* è§¦æ‘¸æ‰‹åŠ¿æ”¯æŒ */
  .swipeable {
    touch-action: pan-x pan-y;
    /* æ”¹å–„æ»‘åŠ¨æ€§èƒ½ */
    will-change: transform;
  }

  /* æ°´å¹³æ»‘åŠ¨å®¹å™¨ */
  .swipe-horizontal {
    touch-action: pan-x;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scroll-snap-type: x mandatory;
  }

  .swipe-horizontal > * {
    scroll-snap-align: start;
  }

  /* å‚ç›´æ»‘åŠ¨å®¹å™¨ */
  .swipe-vertical {
    touch-action: pan-y;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }

  /* æ”¹å–„é•¿æŒ‰ä½“éªŒ */
  .long-press {
    touch-action: manipulation;
    -webkit-touch-callout: default;
  }

  /* è§¦æ‘¸å»¶è¿Ÿä¼˜åŒ– */
  .touch-fast {
    touch-action: manipulation;
    /* ç§»é™¤ç‚¹å‡»å»¶è¿Ÿ */
    -ms-touch-action: manipulation;
  }

  /* ç§»åŠ¨ç«¯è¾“å…¥æ¡†ä¼˜åŒ– */
  @media (max-width: 768px) {
    input[type="text"],
    input[type="email"],
    input[type="password"],
    input[type="search"],
    input[type="tel"],
    input[type="url"],
    textarea {
      /* é˜²æ­¢ iOS è‡ªåŠ¨ç¼©æ”¾ */
      font-size: 16px !important;
      /* æ”¹å–„è§¦æ‘¸ä½“éªŒ */
      touch-action: manipulation;
      /* ç§»é™¤ iOS é»˜è®¤æ ·å¼ */
      -webkit-appearance: none;
      border-radius: 0.375rem;
    }

    /* æ”¹å–„é€‰æ‹©æ¡†è§¦æ‘¸ä½“éªŒ */
    select {
      font-size: 16px !important;
      touch-action: manipulation;
      -webkit-appearance: none;
      padding: 0.75rem 2.5rem 0.75rem 1rem;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
      background-position: right 0.5rem center;
      background-repeat: no-repeat;
      background-size: 1.5em 1.5em;
    }

    /* é”®ç›˜è¾“å…¥ä¼˜åŒ– */
    /* å½“è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹æ—¶ï¼Œç¡®ä¿é¡µé¢å¯ä»¥æ­£ç¡®æ»šåŠ¨ */
    input:focus,
    textarea:focus {
      /* ç¡®ä¿è¾“å…¥æ¡†åœ¨è§†å£ä¸­å¯è§ */
      scroll-margin-top: 20px;
      scroll-margin-bottom: 20px;
    }

    /* é”®ç›˜æ‰“å¼€æ—¶çš„é¡µé¢ä¼˜åŒ– */
    /* iOS Safari ç‰¹æ®Šå¤„ç†ï¼šé”®ç›˜æ‰“å¼€æ—¶ä¼šæ”¹å˜è§†å£é«˜åº¦ */
    @supports (-webkit-touch-callout: none) {
      /* iOS è®¾å¤‡ */
      body.keyboard-open {
        /* é˜²æ­¢é¡µé¢åœ¨é”®ç›˜æ‰“å¼€æ—¶æ»šåŠ¨ */
        position: fixed;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }
    }

    /* é”®ç›˜æ‰“å¼€æ—¶çš„è¾“å…¥æ¡†å®¹å™¨ä¼˜åŒ– */
    .keyboard-input-container {
      /* ç¡®ä¿è¾“å…¥æ¡†å®¹å™¨æœ‰è¶³å¤Ÿçš„ç©ºé—´ */
      padding-bottom: env(safe-area-inset-bottom, 0);
    }
  }
}

/* Highlight.js ä»£ç é«˜äº®æ ·å¼ - ä½¿ç”¨æ·±è‰²ä¸»é¢˜ */
@import 'highlight.js/styles/github-dark.css';