<template>
  <div class="mx-auto max-w-6xl px-4 py-8">
    <h1 class="mb-8 text-3xl font-bold">å›¾ç‰‡ä¼˜åŒ–æ¼”ç¤º</h1>

    <!-- è¯´æ˜ -->
    <div class="mb-8 rounded-lg bg-blue-50 p-6 dark:bg-blue-900/20">
      <h2 class="mb-2 text-xl font-semibold text-blue-900 dark:text-blue-100">
        Nuxt Image + IPX æ–¹æ¡ˆ
      </h2>
      <p class="text-blue-800 dark:text-blue-200">
        æœ¬é¡µé¢æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Nuxt Image å’Œ IPX ä¼˜åŒ– Supabase Storage å›¾ç‰‡ã€‚æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„
        Network æ ‡ç­¾æŸ¥çœ‹å®é™…æ•ˆæœã€‚
      </p>
    </div>

    <!-- æµ‹è¯•ç¤ºä¾‹ -->
    <div class="space-y-12">
      <!-- ç¤ºä¾‹ 1: åŸºç¡€ç”¨æ³• -->
      <section class="rounded-lg border border-gray-200 p-6 dark:border-gray-700">
        <h3 class="mb-4 text-xl font-semibold">1. åŸºç¡€ç”¨æ³•</h3>
        <div class="grid gap-6 md:grid-cols-2">
          <div>
            <h4 class="mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">åŸå§‹å›¾ç‰‡</h4>
            <img
              src="https://picsum.photos/seed/demo1/800/600"
              alt="åŸå§‹å›¾ç‰‡"
              class="w-full rounded-lg"
            />
            <p class="mt-2 text-xs text-gray-500">ç›´æ¥åŠ è½½ï¼Œæ— ä¼˜åŒ–</p>
          </div>
          <div>
            <h4 class="mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">ä¼˜åŒ–å</h4>
            <NuxtImg
              src="https://picsum.photos/seed/demo1/800/600"
              alt="ä¼˜åŒ–åå›¾ç‰‡"
              :width="800"
              :height="600"
              format="webp"
              quality="80"
              loading="lazy"
              class="w-full rounded-lg"
            />
            <p class="mt-2 text-xs text-gray-500">WebP æ ¼å¼ï¼Œ80% è´¨é‡ï¼Œæ‡’åŠ è½½</p>
          </div>
        </div>
        <div class="mt-4 rounded bg-gray-100 p-4 dark:bg-gray-800">
          <code class="text-sm">
            &lt;NuxtImg src="..." :width="800" :height="600" format="webp" quality="80"
            loading="lazy" /&gt;
          </code>
        </div>
      </section>

      <!-- ç¤ºä¾‹ 2: å“åº”å¼å›¾ç‰‡ -->
      <section class="rounded-lg border border-gray-200 p-6 dark:border-gray-700">
        <h3 class="mb-4 text-xl font-semibold">2. å“åº”å¼å›¾ç‰‡ (srcset)</h3>
        <div class="mb-4">
          <NuxtImg
            src="https://picsum.photos/seed/demo2/1600/900"
            alt="å“åº”å¼å›¾ç‰‡"
            :width="1200"
            :height="675"
            sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 1200px"
            format="webp"
            quality="80"
            loading="lazy"
            class="w-full rounded-lg"
          />
          <p class="mt-2 text-xs text-gray-500">
            æ ¹æ®å±å¹•å°ºå¯¸è‡ªåŠ¨åŠ è½½åˆé€‚å¤§å°ï¼šç§»åŠ¨ç«¯ 100vwï¼Œå¹³æ¿ 50vwï¼Œæ¡Œé¢ 1200px
          </p>
        </div>
        <div class="rounded bg-gray-100 p-4 dark:bg-gray-800">
          <code class="text-sm">
            &lt;NuxtImg :width="1200" sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw,
            1200px" /&gt;
          </code>
        </div>
      </section>

      <!-- ç¤ºä¾‹ 3: ä¸åŒæ ¼å¼å¯¹æ¯” -->
      <section class="rounded-lg border border-gray-200 p-6 dark:border-gray-700">
        <h3 class="mb-4 text-xl font-semibold">3. æ ¼å¼å¯¹æ¯”</h3>
        <div class="grid gap-6 md:grid-cols-3">
          <div>
            <h4 class="mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">JPEG</h4>
            <NuxtImg
              src="https://picsum.photos/seed/demo3/800/600"
              alt="JPEG æ ¼å¼"
              :width="400"
              :height="300"
              format="jpeg"
              quality="80"
              class="w-full rounded-lg"
            />
            <p class="mt-2 text-xs text-gray-500">ä¼ ç»Ÿæ ¼å¼ï¼Œå…¼å®¹æ€§å¥½</p>
          </div>
          <div>
            <h4 class="mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">WebP</h4>
            <NuxtImg
              src="https://picsum.photos/seed/demo3/800/600"
              alt="WebP æ ¼å¼"
              :width="400"
              :height="300"
              format="webp"
              quality="80"
              class="w-full rounded-lg"
            />
            <p class="mt-2 text-xs text-gray-500">ä½“ç§¯å‡å°‘ 25-35%</p>
          </div>
          <div>
            <h4 class="mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">AVIF</h4>
            <NuxtImg
              src="https://picsum.photos/seed/demo3/800/600"
              alt="AVIF æ ¼å¼"
              :width="400"
              :height="300"
              format="avif"
              quality="80"
              class="w-full rounded-lg"
            />
            <p class="mt-2 text-xs text-gray-500">ä½“ç§¯å‡å°‘ 50%ï¼Œæœ€æ–°æ ¼å¼</p>
          </div>
        </div>
      </section>

      <!-- ç¤ºä¾‹ 4: é¢„è®¾ä½¿ç”¨ -->
      <section class="rounded-lg border border-gray-200 p-6 dark:border-gray-700">
        <h3 class="mb-4 text-xl font-semibold">4. é¢„è®¾é…ç½®</h3>
        <div class="grid gap-6 md:grid-cols-3">
          <div>
            <h4 class="mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">Thumbnail</h4>
            <NuxtImg
              src="https://picsum.photos/seed/demo4/800/600"
              alt="ç¼©ç•¥å›¾é¢„è®¾"
              preset="thumbnail"
              class="w-full rounded-lg"
            />
            <p class="mt-2 text-xs text-gray-500">400x300, è´¨é‡ 75%</p>
          </div>
          <div>
            <h4 class="mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">Cover</h4>
            <NuxtImg
              src="https://picsum.photos/seed/demo4/800/600"
              alt="å°é¢é¢„è®¾"
              preset="cover"
              :width="400"
              class="w-full rounded-lg"
            />
            <p class="mt-2 text-xs text-gray-500">WebP, è´¨é‡ 80%</p>
          </div>
          <div>
            <h4 class="mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">HD</h4>
            <NuxtImg
              src="https://picsum.photos/seed/demo4/800/600"
              alt="é«˜æ¸…é¢„è®¾"
              preset="hd"
              :width="400"
              class="w-full rounded-lg"
            />
            <p class="mt-2 text-xs text-gray-500">æœ€å¤§ 1920px, è´¨é‡ 85%</p>
          </div>
        </div>
        <div class="mt-4 rounded bg-gray-100 p-4 dark:bg-gray-800">
          <code class="text-sm">
            &lt;NuxtImg preset="thumbnail" /&gt; | &lt;NuxtImg preset="cover" /&gt; | &lt;NuxtImg
            preset="hd" /&gt;
          </code>
        </div>
      </section>

      <!-- ç¤ºä¾‹ 5: è£å‰ªæ¨¡å¼ -->
      <section class="rounded-lg border border-gray-200 p-6 dark:border-gray-700">
        <h3 class="mb-4 text-xl font-semibold">5. è£å‰ªæ¨¡å¼ (fit)</h3>
        <div class="grid gap-6 md:grid-cols-4">
          <div>
            <h4 class="mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">Cover</h4>
            <div class="aspect-square overflow-hidden rounded-lg bg-gray-100 dark:bg-gray-800">
              <NuxtImg
                src="https://picsum.photos/seed/demo5/800/600"
                alt="Cover æ¨¡å¼"
                :width="300"
                :height="300"
                fit="cover"
                format="webp"
                class="h-full w-full"
              />
            </div>
            <p class="mt-2 text-xs text-gray-500">è¦†ç›–ï¼Œå¯èƒ½è£å‰ª</p>
          </div>
          <div>
            <h4 class="mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">Contain</h4>
            <div class="aspect-square overflow-hidden rounded-lg bg-gray-100 dark:bg-gray-800">
              <NuxtImg
                src="https://picsum.photos/seed/demo5/800/600"
                alt="Contain æ¨¡å¼"
                :width="300"
                :height="300"
                fit="contain"
                format="webp"
                class="h-full w-full"
              />
            </div>
            <p class="mt-2 text-xs text-gray-500">åŒ…å«ï¼Œå¯èƒ½ç•™ç™½</p>
          </div>
          <div>
            <h4 class="mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">Fill</h4>
            <div class="aspect-square overflow-hidden rounded-lg bg-gray-100 dark:bg-gray-800">
              <NuxtImg
                src="https://picsum.photos/seed/demo5/800/600"
                alt="Fill æ¨¡å¼"
                :width="300"
                :height="300"
                fit="fill"
                format="webp"
                class="h-full w-full"
              />
            </div>
            <p class="mt-2 text-xs text-gray-500">å¡«å……ï¼Œå¯èƒ½å˜å½¢</p>
          </div>
          <div>
            <h4 class="mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">Inside</h4>
            <div class="aspect-square overflow-hidden rounded-lg bg-gray-100 dark:bg-gray-800">
              <NuxtImg
                src="https://picsum.photos/seed/demo5/800/600"
                alt="Inside æ¨¡å¼"
                :width="300"
                :height="300"
                fit="inside"
                format="webp"
                class="h-full w-full"
              />
            </div>
            <p class="mt-2 text-xs text-gray-500">é€‚åº”å†…éƒ¨</p>
          </div>
        </div>
      </section>

      <!-- ç¤ºä¾‹ 6: æ¨¡ç³Šå ä½ç¬¦ -->
      <section class="rounded-lg border border-gray-200 p-6 dark:border-gray-700">
        <h3 class="mb-4 text-xl font-semibold">6. æ¨¡ç³Šå ä½ç¬¦ (LQIP)</h3>
        <div class="mb-4">
          <NuxtImg
            src="https://picsum.photos/seed/demo6/1200/800"
            alt="æ¨¡ç³Šå ä½ç¬¦"
            :width="1200"
            :height="800"
            :placeholder="[20, 13, 75, 5]"
            format="webp"
            loading="lazy"
            class="w-full rounded-lg"
          />
          <p class="mt-2 text-xs text-gray-500">
            æ»šåŠ¨åˆ°æ­¤å›¾ç‰‡æ—¶è§‚å¯Ÿï¼šå…ˆæ˜¾ç¤ºæ¨¡ç³Šé¢„è§ˆï¼Œç„¶ååŠ è½½é«˜æ¸…å›¾
          </p>
        </div>
        <div class="rounded bg-gray-100 p-4 dark:bg-gray-800">
          <code class="text-sm">
            &lt;NuxtImg :placeholder="[20, 13, 75, 5]" /&gt;
            <span class="ml-2 text-gray-600 dark:text-gray-400"
              >// [width, height, quality, blur]</span
            >
          </code>
        </div>
      </section>

      <!-- æ€§èƒ½å¯¹æ¯” -->
      <section class="rounded-lg border border-gray-200 p-6 dark:border-gray-700">
        <h3 class="mb-4 text-xl font-semibold">7. æ€§èƒ½å¯¹æ¯”</h3>
        <div class="overflow-x-auto">
          <table
            class="w-full border-collapse text-sm"
            aria-label="å›¾ç‰‡ä¼˜åŒ–æ€§èƒ½å¯¹æ¯”è¡¨"
            role="table"
          >
            <thead>
              <tr class="border-b border-gray-200 dark:border-gray-700">
                <th class="px-4 py-2 text-left">æŒ‡æ ‡</th>
                <th class="px-4 py-2 text-left">ä¼˜åŒ–å‰</th>
                <th class="px-4 py-2 text-left">ä¼˜åŒ–å</th>
                <th class="px-4 py-2 text-left">æå‡</th>
              </tr>
            </thead>
            <tbody>
              <tr class="border-b border-gray-200 dark:border-gray-700">
                <td class="px-4 py-2">å›¾ç‰‡å¤§å°</td>
                <td class="px-4 py-2">800 KB (JPEG)</td>
                <td class="px-4 py-2">120 KB (WebP)</td>
                <td class="px-4 py-2 text-green-600 dark:text-green-400">-85%</td>
              </tr>
              <tr class="border-b border-gray-200 dark:border-gray-700">
                <td class="px-4 py-2">é¦–æ¬¡åŠ è½½</td>
                <td class="px-4 py-2">1.5-3s</td>
                <td class="px-4 py-2">0.3-0.8s</td>
                <td class="px-4 py-2 text-green-600 dark:text-green-400">-73%</td>
              </tr>
              <tr class="border-b border-gray-200 dark:border-gray-700">
                <td class="px-4 py-2">äºŒæ¬¡åŠ è½½</td>
                <td class="px-4 py-2">1.5-3s</td>
                <td class="px-4 py-2">5-20ms (ç¼“å­˜)</td>
                <td class="px-4 py-2 text-green-600 dark:text-green-400">-99%</td>
              </tr>
              <tr>
                <td class="px-4 py-2">ç§»åŠ¨ç«¯æµé‡</td>
                <td class="px-4 py-2">800 KB</td>
                <td class="px-4 py-2">80-120 KB</td>
                <td class="px-4 py-2 text-green-600 dark:text-green-400">-85%</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- è°ƒè¯•ä¿¡æ¯ -->
      <section class="rounded-lg border border-gray-200 p-6 dark:border-gray-700">
        <h3 class="mb-4 text-xl font-semibold">8. è°ƒè¯•ä¿¡æ¯</h3>
        <div class="space-y-2 text-sm">
          <p>
            <span class="font-medium">æµè§ˆå™¨æ”¯æŒ:</span>
            <span class="ml-2 text-gray-600 dark:text-gray-400">{{ browserFormat }}</span>
          </p>
          <p>
            <span class="font-medium">è®¾å¤‡åƒç´ æ¯”:</span>
            <span class="ml-2 text-gray-600 dark:text-gray-400">{{ devicePixelRatio }}</span>
          </p>
          <p>
            <span class="font-medium">è§†å£å®½åº¦:</span>
            <span class="ml-2 text-gray-600 dark:text-gray-400">{{ viewportWidth }}px</span>
          </p>
        </div>
        <div class="mt-4 rounded bg-blue-50 p-4 dark:bg-blue-900/20">
          <p class="text-sm text-blue-800 dark:text-blue-200">
            ğŸ’¡ æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12) â†’ Network æ ‡ç­¾ â†’ ç­›é€‰ Imgï¼ŒæŸ¥çœ‹å®é™…åŠ è½½çš„å›¾ç‰‡å¤§å°å’Œæ ¼å¼
          </p>
        </div>
      </section>
    </div>
  </div>
</template>

<script setup lang="ts">
const { detectImageFormat } = useImageOptimizer()

const browserFormat = ref('æ£€æµ‹ä¸­...')
const devicePixelRatio = ref(1)
const viewportWidth = ref(0)

onMounted(() => {
  browserFormat.value = detectImageFormat()
  devicePixelRatio.value = window.devicePixelRatio || 1
  viewportWidth.value = window.innerWidth

  // ç›‘å¬çª—å£å¤§å°å˜åŒ–
  const updateViewport = () => {
    viewportWidth.value = window.innerWidth
  }
  window.addEventListener('resize', updateViewport)

  onUnmounted(() => {
    window.removeEventListener('resize', updateViewport)
  })
})

// SEO
useHead({
  title: 'å›¾ç‰‡ä¼˜åŒ–æ¼”ç¤º',
  meta: [
    {
      name: 'description',
      content: 'Nuxt Image + IPX å›¾ç‰‡ä¼˜åŒ–æ–¹æ¡ˆæ¼”ç¤ºé¡µé¢'
    }
  ]
})
</script>
